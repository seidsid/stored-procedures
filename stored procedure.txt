
DELIMITER |
CREATE PROCEDURE batch()
    BEGIN
        DECLARE tid FLOAT;
        DECLARE batchSize INT;
        declare total INT;
        declare looplimit INT;
        declare counter INT;
        
        SET batchSize = 2;
        
        SET tid = (SELECT MAX(transaction_id) FROM transactions)+1;
        
        set total = (select count(*) from transactions where (date(datee) = date(now()) and transaction_id is null));
		
		set looplimit = ceil(total/batchSize);
        set counter = 0;
        
        while counter < looplimit do
			update transactions set transaction_id = (tid+counter) where transaction_id is null order by id limit batchSize;
            set counter = counter + 1;
		end while;
        
        select distinct(transactions.transaction_id) from transactions where transaction_id >= tid;
    END
|